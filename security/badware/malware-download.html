<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Malware download page</title>
    <script>
        // eslint-disable-next-line no-unused-vars
        function getUrl() {
            const delayedCheckbox = document.getElementById('delayedCheckbox');
            return delayedCheckbox.checked ? "/security/badware/phishing-redirect/download?delay=5000" : "/security/badware/phishing-redirect/download";
        }

        function linkHrefDownload() {
            const url = getUrl();
            const link = document.createElement('a');
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function blobDownload() {
            const url = getUrl();
            const response = await fetch(url);
            const blob = await response.blob();
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'example.exe'; 
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(link.href);
        }

        function xhrDownload() {
            const url = getUrl();
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.responseType = 'blob';
            xhr.onload = function () {
            const blob = new Blob([xhr.response], { type: 'application/octet-stream' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'example.exe'; 
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(link.href);
            };
            xhr.send();
        }

        function iframeDownload() {
            const url = getUrl();
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = url;
            document.body.appendChild(iframe);
            setTimeout(() => {
            document.body.removeChild(iframe);
            }, 1000); // Clean up after a second
        }

        function windowLocationDownload() {
            const url = getUrl();
            window.location.href = url;
        }

        async function fetchStreamDownload() {
            const url = getUrl();
            const response = await fetch(url);
            const reader = response.body.getReader();
            const contentLength = +response.headers.get('Content-Length');
            let receivedLength = 0; // Received bytes
            const chunks = []; // Array of received binary chunks (comprises the body)

            while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            chunks.push(value);
            receivedLength += value.length;
            console.log(`Received ${receivedLength} of ${contentLength}`);
            }

            const blob = new Blob(chunks);
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'example.exe';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(link.href);
        }
    </script>
</head>

<body>
    <p><a href="/security/badware/">[Back]</a></p>

    <h1>Malware download page</h1>

    <p>This is an example malware page that DuckDuckGo clients intend to block. If you arrive here by mistake; there's
        nothing to worry about, we just use this page to test if our client blocking is working.</p>

    <h2>Blocked URL Targets</h2>
    <p>Click the buttons below to test various malware detection techniques based on JS file download techniques:</p>
    <label>
        <input type="checkbox" id="delayedCheckbox"> Delay Download
    </label>
    <ul>
        <li><button id="run" onclick="linkHrefDownload()">Href Download Button</button></li>
        <li><button id="run" onclick="blobDownload()">Blob Download Button</button></li>
        <li><button id="run" onclick="xhrDownload()">XHR Download Button</button></li>
        <li><button id="run" onclick="iframeDownload()">Iframe Download Button</button></li>
        <li><button id="run" onclick="windowLocationDownload()">Window Location Download Button</button></li>
        <li><button id="run" onclick="fetchStreamDownload()">Fetch Stream Download Button</button></li>
        <li><a href="/security/badware/phishing-redirect/download">Download Link</a></li>
    </ul>

    <h2>Blocked File Content</h2>
    <p>These links are to files where the file content should be blocked, as opposed to the file URL or JS technique:</p>
    <ul>
        <li><a href="/security/badware/phishing-redirect/files/bad_app_file_on_scan.exe">Uncommon, then "malicious" warning after deep scanning</a></li>
        <li><a href="/security/badware/phishing-redirect/files/unknown.apk">File warning on Android</a></li>
        <li><a href="/security/badware/phishing-redirect/files/content.exe">File warning on Desktop</a></li>
        <li><a href="/security/badware/phishing-redirect/files/zip_password_1234.zip">Password Protected ZIP</a></li>
    </ul>
</body>

</html>