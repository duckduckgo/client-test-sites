<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>API call attribution test</title>
</head>

<body>
<p><a href="../../index.html">[Home]</a> â†£ <strong>[API call attribution test]</strong></p>

<p>This page tests various ways of script injection to verify that API calls (navigator.userAgent in particular) are attributed to the correct script URL.</p>

<table>
    <thead>
        <tr>
            <th>#</th>
            <th>API call</th>
            <th>Description</th>
            <th>Context URL</th>
            <th>Expected attribution URL</th>
        </tr>
    </thead>
    <tbody id="results"></tbody>
</table>
<template id="result-row">
    <tr>
        <td class="idx"></td>
        <td class="api"></td>
        <td class="desc"></td>
        <td class="context"></td>
        <td class="expected"></td>
    </tr>
</template>

<div id="container"></div>

<script>
    const ul = document.getElementById('results');
    const template = document.getElementById('result-row');
    const results = [];
    let idx = 1;

    window.addResult = function (api, desc, contextUrl, expectedAttributionUrl) {
        results.push({ api, desc, contextUrl, expectedAttributionUrl });
        const listEntry = template.content.cloneNode(true);
        listEntry.querySelector('.idx').textContent = idx++;
        listEntry.querySelector('.api').textContent = api;
        listEntry.querySelector('.desc').textContent = desc;
        listEntry.querySelector('.context').textContent = contextUrl;
        listEntry.querySelector('.expected').textContent = expectedAttributionUrl;
        ul.appendChild(listEntry);
    };
</script>

<script>
    console.log(location.href, navigator.userAgent);
    window.addResult('Navigator.prototype.userAgent', 'normal inline script', window.location.href, window.location.href);
</script>
<script src="entrypoints/createelement.js"></script>
<script src="entrypoints/eval.js"></script>
<script src="entrypoints/dom0.js"></script>
<script src="entrypoints/blob-url.js"></script>
<script src="entrypoints/data-url.js"></script>
<script src="entrypoints/document-write.js"></script>
<script src="entrypoints/iframe-blob-url.js"></script>
<script src="entrypoints/iframe-data-url.js"></script>
<script src="entrypoints/iframe-javascript-url.js"></script>
<script src="entrypoints/iframe-document-write.js"></script>
<script src="entrypoints/iframe-sandbox.js"></script>
<script src="entrypoints/iframe-simple.js"></script>
<script src="entrypoints/eventlistener.js"></script>
<script src="entrypoints/settimeout.js"></script>
<script src="entrypoints/promise.js"></script>
<script src="entrypoints/module.mjs" type="module"></script>
<script src="entrypoints/deep-stack.js"></script>
<script src="entrypoints/deep-async-stack.js"></script>
<script src="entrypoints/web-worker.js"></script>
<script src="entrypoints/service-worker.js"></script>
<script src="entrypoints/prototype-overload.js"></script>

<style>
    table {
        border-radius: 3px;
        border: solid 1px;
        max-width: 100%;
    }
    table th,table td {
        border: solid 1px;
        padding: 10px;
    }
</style>
</body>
</html>
