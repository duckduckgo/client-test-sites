<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Facebook click to load</title>
</head>
<body>
  <!-- Load the facebook SDK in the recommended way -->
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js?XFBML=false"></script>
<p><a href="../../">[Home]</a> ↣ <a href="../">[Privacy Protections Tests]</a> ↣ <strong>[Facebook click to load]</strong></p>

<h2> About ClickToLoad Tests</h2>  
<p>This page embeds the facebook SDK, and several facebook iFrames. It also attempts to create 
a variety of social elements using the SDK.</P>

<p>The page will count how many facebook requests have been sent. In some cases, the browser may start requesting iFrame links, which should be blocked by the extension (but will be counted in the Facebook calls). Calls should not exceed iFrames (and manual verification that those network calls were blocked is a good practice). Once elements are clicked, the count should increase and elements should display (in most cases - this page does not use a valid SDK APP ID, so not all functions work correctly, login in particular.).</p>

<h2> Metrics </h2>
<div id="facebook_calls"> Facebook Calls: <span id="facebook_call_count">0</span></div>
<div id="facebook_calls"> Facebook iFrames: <span id="facebook_iFrames">0</span></div>
<p><button id='download'>Download the result</button></p>

<h2> All the social buttons from the SDK </h2>
<div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/1" data-width="" data-layout="standard" data-action="like" data-size="small" data-share="true"></div>
<br /><div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/2" data-width="" data-layout="standard" data-action="recommend" data-size="small" data-share="true"></div>
<br /><div class="fb-save" data-uri="https://developers.facebook.com/docs/plugins/1" data-size="large"></div>
<br /><div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count" data-size="small"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>

<h2> All the social buttons in iFrames </h2>
<iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins2%2F&width=450&layout=standard&action=like&size=small&share=true&height=35&appId" width="450" height="35" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
<br /><iframe src="https://www.facebook.com/v2.0/plugins/like.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins1%2F&width=450&layout=standard&action=like&size=small&share=true&height=35&appId" width="450" height="35" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
<br /><iframe src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&layout=button_count&size=small&width=121&height=20&appId" width="121" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>

<h2> Login buttons (SDK & custom) </h2>
<p style="color: #9F6000;background-color: #FEEFB3; margin: 10px 22px; padding: 10px; font-size:1.2em;vertical-align:middle;">&#x26A0; Login buttons only work with a valid Facebook developer account. This page is not configured with a real account, so is unlikely to show a proper login button, and the login flow may create errors. For true login testing, use a real FB account and actual pages with login.</p>
<br /><div class="fb-login-button" data-width="" data-size="large" data-button-type="continue_with" data-layout="default" data-auto-logout-link="false" data-use-continue-as="false"></div>
<br /><button id="custom-fb-login-button" style="padding:10px; background-color: #00ccff" type="button">Custom Facebook Login</button>
<div id="loginResponse"></div>


<h2> Objects replaced by the SDK </h2>
<br /><div class="fb-page" data-href="https://www.facebook.com/facebook" data-tabs="timeline" data-width="1200" data-height="800" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/facebook" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/facebook">Facebook</a></blockquote></div>
<br /><div class="fb-comments" data-href="https://developers.facebook.com/docs/plugins/comments#configurator" data-width="" data-numposts="5"></div>
<br /><div class="fb-comment-embed" data-href="https://www.facebook.com/zuck/posts/10102735452532991?comment_id=1070233703036185" data-width="500"></div>
<br /><div class="fb-post" data-href="https://www.facebook.com/20531316728/posts/10154009990506729/" data-width="500" data-show-text="true"><blockquote cite="https://www.facebook.com/20531316728/posts/10154009990506729/" class="fb-xfbml-parse-ignore">Posted by <a href="https://www.facebook.com/facebookapp/">Facebook App</a> on&nbsp;<a href="https://www.facebook.com/20531316728/posts/10154009990506729/">Thursday, August 27, 2015</a></blockquote></div>
<br /><div class="fb-video" data-href="https://www.facebook.com/facebook/videos/10153231379946729/" data-width="500" data-show-text="false"><blockquote cite="https://developers.facebook.com/facebookapp/videos/10153231379946729/" class="fb-xfbml-parse-ignore"><a href="https://developers.facebook.com/facebookapp/videos/10153231379946729/">How to Share With Just Friends</a><p>How to share with just friends.</p>Posted by <a href="https://www.facebook.com/facebookapp/">Facebook App</a> on Friday, December 5, 2014</blockquote></div>
<br /><div class="fb-group" data-href="https://www.facebook.com/groups/ayearofrunning/" data-width="280" data-show-social-context="true" data-show-metadata="false"><blockquote cite="https://www.facebook.com/groups/ayearofrunning/" class="fb-xfbml-parse-ignore">A Year of Running</blockquote></div>
<br /><div class="fb-quote"></div>

<h2> Objects in iFrames </h2>
<br /><iframe src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Ffacebook&tabs=timeline&width=300&height=390&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId" width="500" height="300" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
<br /><iframe src="https://www.facebook.com/plugins/comment_embed.php?href=https%3A%2F%2Fwww.facebook.com%2Fzuck%2Fposts%2F10102577175875681%3Fcomment_id%3D1193531464007751%26reply_comment_id%3D654912701278942&width=560&include_parent=false&height=152&appId" width="560" height="152" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
<br /><iframe src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2F20531316728%2Fposts%2F10154009990506729%2F&width=500&show_text=true&height=292&appId" width="500" height="292" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
<br /><iframe src="https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2Ffacebook%2Fvideos%2F10153231379946729%2F&width=500&show_text=false&height=280&appId" width="500" height="280" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share" allowFullScreen="true"></iframe>
<p> Groups don't currently allow iFrame displays, but the documentation still shows this as a valid method of showing groups, so it's included here in case it changes again in the future </p> 
<br /><iframe src="https://www.facebook.com/plugins/group.php?href=https%3A%2F%2Fwww.facebook.com%2Fgroups%2Fayearofrunning%2F&width=280&show_social_context=true&show_metadata=false&height=267&appId" width="280" height="267" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>

<script>
let facebookCalls = 0;
let fbIFrames = 0;

// Find all the iFrames currently on page.
const frameNodes = document.querySelectorAll('iFrame');
fbIFrames = frameNodes.length
document.getElementById('facebook_iFrames').innerHTML = fbIFrames;

// This initializes the facebook SDK.
window.fbAsyncInit = function () {
    // eslint-disable-next-line no-undef
    FB.init({
        appId: '',
        autoLogAppEvents: true,
        xfbml: true,
        version: 'v9.0'
    });

    function fbLogin () {
        const displayArea = document.getElementById('loginResponse');
        displayArea.innerHTML = 'Calling FB SDK... ';
        // eslint-disable-next-line no-undef
        FB.login(function (response) {
            if (response.authResponse) {
                displayArea.innerHTML = 'Starting FB login... ';
                // eslint-disable-next-line no-undef
                FB.api('/me', function (response) {
                    displayArea.innerHTML = `Logged in as ${response.name}`;
                });
            } else {
                displayArea.innerHTML = 'User cancelled login or did not fully authorize.';
            }
        });
    }

    const loginButton = document.getElementById('custom-fb-login-button');
    loginButton.addEventListener('click', fbLogin);
};

function displayFacebookCalls (callCount) {
    document.getElementById('facebook_call_count').innerHTML = callCount;
}

function facebookObserver (list, observer) {
    const resourceLoads = list.getEntriesByType('resource');
    for (const resource of resourceLoads) {
        if (resource.name.match(/facebook.com|facebook.net/)) {
            /* Observer still counts calls that fail, but the duration is less. In testing,
             * failed iFrames always returned in around 100 or less, with success generally being
             * above 200. Occasionally, a loaded resource comes in around 150. If Facebook requests
             * are allowed, there will also be other resources that load - scripts and content
             * which will always be counted.
            */
            if (resource.initiatorType !== 'iframe' || resource.duration > 150) {
                facebookCalls += 1;
            }
        }
    }
    displayFacebookCalls(facebookCalls);
}

const observer = new PerformanceObserver(facebookObserver);
observer.observe({ entryTypes: ['resource'] });

function downloadTheResults () {
    const data = JSON.stringify({ facebookCalls: facebookCalls, facebookIframes: fbIFrames });
    const a = document.createElement('a');
    const url = window.URL.createObjectURL(new Blob([data], { type: 'application/json' }));
    a.href = url;
    a.download = 'click-to-load-results.json';

    document.body.appendChild(a);
    a.click();

    window.URL.revokeObjectURL(url);
    a.remove();
}

const downloadButton = document.querySelector('#download');
downloadButton.addEventListener('click', () => downloadTheResults());
</script>
  
</body>
</html>
