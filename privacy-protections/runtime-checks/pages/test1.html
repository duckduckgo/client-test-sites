<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Runtime checks</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
    <script src="../utils.js"></script>
    <p><a href="../index.html">[Runtime checks]</a></p>

    <p>This page verifies that runtime checking is enabled given the corresponding <a href="../config/test1.json">config</a></p>

    <script>
        window.scripty1Ran = false;
        const scriptElement = document.createElement('script');
        scriptElement.innerText = 'window.scripty1Ran = true';
        scriptElement.id = 'scripty';
        scriptElement.setAttribute('type', 'application/evilscript');
        document.body.appendChild(scriptElement);
        const hadInspectorNode = scriptElement === document.querySelector('ddg-runtime-checks');
        // Continue to modify the script element after it has been added to the DOM
        scriptElement.integrity = 'sha256-123';
        scriptElement.madeUpProp = 'val';
        const instanceofResult = scriptElement instanceof HTMLScriptElement;
        const scripty = document.querySelector('#scripty');

        const results = [
            { name: 'hadInspectorNode', result: hadInspectorNode, expected: true },
            { name: 'expect script to match', result: scripty, expected: scriptElement },
            { name: 'instanceof matches HTMLScriptElement', result: instanceofResult, expected: true },
            { name: 'scripty.integrity', result: scripty.integrity, expected: 'sha256-123' },
            { name: 'scripty.madeUpProp', result: scripty.madeUpProp, expected: 'val' },
            { name: 'scripty.type', result: scripty.type, expected: 'application/evilscript' },
            { name: 'scripty.id', result: scripty.id, expected: 'scripty' },
            { name: 'script ran', result: window.scripty1Ran, expected: false }
        ];
        // eslint-disable-next-line no-undef
        document.body.appendChild(buildResultTable(results));
    </script>
</body>
</html>
